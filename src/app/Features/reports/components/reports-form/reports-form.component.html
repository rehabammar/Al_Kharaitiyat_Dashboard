<main>
  <section class="slider-area slider-area2">
    <div class="slider-active">
      <div class="single-slider slider-height2">
      </div>
    </div>
  </section>

  <div class="accordion-container">
    <app-custom-accordion title="reports">

      <form class="generic-form-container" #f="ngForm">
        <div class="form-grid">

          <!-- Report type (required) -->
          <div>
            <div class="header-label-line align-start">
              <label class="form-label">{{ 'Reports.ReportType' | translate }}</label>
              <span class="required-indicator">*</span>
            </div>
            <select class="custom-input" name="type" [(ngModel)]="reportType" required>
              <option value="attendance">{{ 'Reports.Types.Attendance' | translate }}</option>
              <option value="payments">{{ 'Reports.Types.Payments' | translate }}</option>
              <option value="teacherCourses">{{ 'Reports.Types.TeacherCourses' | translate }}</option>
              <option value="transportationCosts">{{ 'Reports.Types.TransportationCosts' | translate }}</option>
              <option value="classes">{{ 'Reports.Types.Classes' | translate }}</option>
            </select>
          </div>

          

          <!-- Start date (required) -->
          <div *ngIf="reportType !== 'classes' ">
            <div class="header-label-line align-start">
              <label class="form-label">{{ 'Reports.StartDate' | translate }}</label>
              <span class="required-indicator">*</span>
            </div>
            <input class="custom-input date-field" 
                    type="date" 
                    name="startDate"
                    [(ngModel)]="startDate" 
                    required /> 
            <!-- <mat-form-field appearance="fill">
              <mat-label>Start Date</mat-label>
              <input matInput [matDatepicker]="picker" [(ngModel)]="startDate">
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>   -->
          </div>

          <!-- End date (required, min=startDate) -->
          <div *ngIf="reportType !== 'classes' ">
            <div class="header-label-line align-start">
              <label class="form-label">{{ 'Reports.EndDate' | translate }}</label>
              <span class="required-indicator">*</span>
            </div>
            <input class="custom-input date-field" type="date" name="endDate" [(ngModel)]="endDate"
              [min]="startDate || null" required />
            <div class="error-text" *ngIf="endDate && startDate && endDate < startDate">
              {{ 'validation.endDateBeforeStart' | translate: { start: startDate } }}
            </div>
          </div>


              <div *ngIf="reportType === 'classes' ">
            <div class="header-label-line align-start">
              <label class="form-label">{{ 'Reports.Date' | translate }}</label>
              <span class="required-indicator">*</span>
            </div>
            <input class="custom-input date-field" 
                    type="date" 
                    name="startDate"
                    [(ngModel)]="startDate" 
                    required /> 
            <!-- <mat-form-field appearance="fill">
              <mat-label>Start Date</mat-label>
              <input matInput [matDatepicker]="picker" [(ngModel)]="startDate">
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>   -->
          </div>
        

          <!-- Optional: Teacher -->
          <div *ngIf="reportType === 'teacherCourses' || reportType === 'attendance' || reportType === 'transportationCosts'">
             <app-search-field
              [label]="'Reports.Teacher' | translate"
              [value]="selectedTeacher?.fullName!"
              [disabled]="true"
              [showClear]="!!selectedTeacher"
              (clear)="clearUser(UserSearchType.Teacher)"
              (search)="openUsersSearchDialog(ApiEndpoints.getTeacherUsers, UserSearchType.Teacher)">
            </app-search-field>
          </div>

          <!-- Optional: Student -->
          <div *ngIf="reportType === 'attendance'">
            <app-search-field
              [label]="'Reports.Student' | translate"
              [value]="selectedStudent?.fullName!"
              [disabled]="true"
              [showClear]="!!selectedStudent"
              (clear)="clearUser(UserSearchType.Student)"
              (search)="openUsersSearchDialog(ApiEndpoints.getStudentUsers, UserSearchType.Student)">
            </app-search-field>
          </div>

          <!-- Optional: User -->
          <div *ngIf="reportType === 'payments'" >
            <app-search-field
              [label]="'Reports.User' | translate"
              [value]="selectedUser?.fullName!"
              [disabled]="true"
              [showClear]="!!selectedUser"
              (clear)="clearUser(UserSearchType.User)"
              (search)="openUsersSearchDialog(ApiEndpoints.getAllUsers, UserSearchType.User)">
            </app-search-field>
          </div>

          <!-- Optional: Course -->
          <div *ngIf="reportType === 'attendance'">
         <app-search-field
            [label]="'Reports.Course' | translate"
            [value]="selectedCourse?.teacherCourseName!"
            [showClear]="!!selectedCourse"
            (clear)="clearCourse()"
            (search)="openCourseSearchDialog()">
          </app-search-field>

          </div>

        </div>
      </form>
      <div class="form-actions">
        <app-button [label]="(downloading ? 'Reports.Downloading' : 'Reports.Download') | translate"
          [imageSrc]="downloading ? '/assets/img/icon/loader.gif' : '/assets/img/icon/download.png'"
          [onClick]="onDownloadReports"
          [disabled]="downloading || !f.valid || (!!endDate && !!startDate && (endDate < startDate))"
          [showButton]="true">
        </app-button>
      </div>

    </app-custom-accordion>

  </div>
</main>